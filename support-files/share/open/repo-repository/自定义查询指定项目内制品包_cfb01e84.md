# 自定义查询指定项目内制品包
功能描述：自定义查询指定项目内制品包

### 请求地址
```
/repo-repository/api/package/search
```

### 请求方法
`POST`
### 请求参数

#### 请求头参数

| 字段                  | 类型   | 必填 | 描述                  |
| --------------------- | ------ | ---- | --------------------- |
| X-DEVOPS-ACCESS-TOKEN | String | 是   | OpenAPI认证token      |
| Authorization         | String | 是   | 制品库basic认证请求头 |

#### 路径参数

无

#### 查询参数

无

#### 请求体参数

##### 说明

> 请求体是一个json格式的对象`QueryModel`, 其结构如下(仅展示结构, 不能这样传参): 

```json
{
  "// QueryModel": "自定义查询模型",
  "QueryModel": {
    "// PageLimit": "分页参数",
    "PageLimit": {
      "// pageNumber": "当前页(默认第1页)",
      "pageNumber": 1,
      "// pageSize": "每页数量(默认20)",
      "pageSize": 20,
      "// current": "已废弃, 由pageNumber代替",
      "current": 1,
      "// size": "已废弃, 由pageSize代替",
      "size": 20
    },
    "// Sort": "排序规则",
    "Sort": {
      "// properties": "排序字段",
      "properties": ["folder", "lastModifiedDate"],
      "// direction": "排序方式, 不填默认为ASC",
      "direction": "DESC"
    },
    "// select": "筛选字段列表",
    "select": [],
    "// Rule": "查询规则, 有3种",
    "Rule": {}
  }
}
```

查询规则结构

```json
{
  "// NestedRule": "嵌套查询规则",
  "NestedRule": {
    "// rules": "规则集",
    "rules": [
      { "NestedRule1": "..." },
      { "NestedRule2": "..." },
      { "QueryRule": "..." },
      { "FixedRule": "..." }
    ],
    "// relation": "组合条件类型: AND, OR, NOR",
    "relation": "AND"
  },
  "// QueryRule": "条件查询规则",
  "QueryRule": {
    "// field": "字段",
    "field": "field",
    "// value": "值",
    "value": "value",
    "// operation": "操作类型: EQ, NE, LT, LTE, GT, GTE...",
    "operation": "EQ"
  },
  "// FixedRule": "固定查询规则",
  "FixedRule": {
    "// wrapperRule": "对QueryRule的一次包装",
    "wrapperRule": { "QueryRule": "..." }
  }
}
```

##### 请求体json示例

```json
{
    "page": {
        "pageNumber": 1,
        "pageSize": 20
    },
    "sort": {
        "properties": [
            "lastModifiedDate"
        ],
        "direction": "ASC"
    },
    "rule": {
        "rules": [
            {
                "field": "projectId",
                "value": "e8156e",
                "operation": "EQ"
            },
            {
                "field": "repoType",
                "value": "MAVEN",
                "operation": "EQ"
            },
            {
                "field": "repoName",
                "value": ["maven-local","repo2"],
                "operation": "IN"
            },
            {
                "field": "name",
                "value": "*spring*",
                "operation": "MATCH_I"
            }
        ],
        "relation": "AND"
    }
}
```

### 返回结果

| 字段      | 说明     |
|---------|--------|
| code    | 返回码    |
| message | 错误信息   |
| data    | 数据     |
| traceId | 链路追踪id |

#### 响应体示例

```json
{
    "code": 0,
    "message": null,
    "data": {
        "pageNumber": 1,
        "pageSize": 20,
        "totalRecords": 8,
        "totalPages": 1,
        "records": [
            {
                "_id": {
                    "timestamp": 1700533707,
                    "date": 1700533707000
                },
                "versionTag": {},
                "projectId": "e8156e",
                "lastModifiedBy": "admin",
                "key": "gav://org.springframework:spring-framework-bom",
                "extension": null,
                "historyVersion": [
                    "5.1.3.RELEASE"
                ],
                "downloads": 0,
                "versions": 1,
                "lastModifiedDate": 1700533707891,
                "repoName": "maven-local",
                "createdBy": "admin",
                "createdDate": 1700533707887,
                "type": "MAVEN",
                "name": "spring-framework-bom",
                "description": null,
                "latest": "5.1.3.RELEASE",
                "scanStatus": "QUALITY_PASS"
            },
            {
                "_id": {
                    "timestamp": 1701394280,
                    "date": 1701394280000
                },
                "createdBy": "admin",
                "repoName": "repo2",
                "extension": null,
                "lastModifiedBy": "admin",
                "key": "gav://org.springframework:spring-jdbc",
                "type": "MAVEN",
                "lastModifiedDate": 1701394280270,
                "createdDate": 1701394280268,
                "projectId": "e8156e",
                "downloads": 1,
                "historyVersion": [
                    "4.3.9.RELEASE"
                ],
                "name": "spring-jdbc",
                "versionTag": {},
                "versions": 1,
                "description": null,
                "latest": "4.3.9.RELEASE",
                "scanStatus": "QUALITY_PASS"
            }
        ],
        "count": 2,
        "page": 1
    },
    "traceId": "c42c90f673e0b2959231d6251d9b9679"
}
```

#### data 字段说明

分页信息

| 字段           | 说明                     |
|--------------|------------------------|
| pageNumber   | 页码(从1页开始)              |
| pageSize     | 每页多少条                  |
| totalRecords | 总记录条数                  |
| totalPages   | 总页数                    |
| records      | **数据列表**               |
| count        | 已废弃, 由`totalRecords`代替 |
| page         | 已废弃, 由`pageNumber`代替   |

##### records 字段说明

节点信息

| 字段             | 说明               |
| ---------------- | ------------------ |
| createdBy        | 创建者             |
| createdDate      | 创建时间           |
| lastModifiedBy   | 修改者             |
| lastModifiedDate | 修改时间           |
| projectId        | 项目ID             |
| repoName         | 仓库名称           |
| type             | 制品包类型         |
| key              | 制品包key          |
| name             | 制品包名称         |
| versions         | 版本数量           |
| versionTag       | 版本标签映射       |
| latest           | 最新版本号         |
| downloads        | 总下载量           |
| extension        | 扩展字段           |
| description      | 制品包描述         |
| scanStatus       | 最新版本的扫描状态 |
| historyVersion   | 历史存在过的版本号 |

