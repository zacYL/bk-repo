# 自定义查询节点

功能描述：自定义查询节点

### 请求地址

```
/repo-repository/api/node/search
```

### 请求方法

`POST`

### 请求参数

#### 请求体参数

##### 说明

> 请求体是一个json格式的对象`QueryModel`, 其结构如下(仅展示结构, 不能这样传参): 

```json
{
  "// QueryModel": "自定义查询模型",
  "QueryModel": {
    "// PageLimit": "分页参数",
    "PageLimit": {
      "// pageNumber": "当前页(默认第1页)",
      "pageNumber": 1,
      "// pageSize": "每页数量(默认20)",
      "pageSize": 20,
      "// current": "已废弃, 由pageNumber代替",
      "current": 1,
      "// size": "已废弃, 由pageSize代替",
      "size": 20
    },
    "// Sort": "排序规则",
    "Sort": {
      "// properties": "排序字段",
      "properties": ["folder", "lastModifiedDate"],
      "// direction": "排序方式, 不填默认为ASC",
      "direction": "DESC"
    },
    "// select": "筛选字段列表",
    "select": [],
    "// Rule": "查询规则, 有3种",
    "Rule": {}
  }
}
```

查询规则结构

```json
{
  "// NestedRule": "嵌套查询规则",
  "NestedRule": {
    "// rules": "规则集",
    "rules": [
      { "NestedRule1": "..." },
      { "NestedRule2": "..." },
      { "QueryRule": "..." },
      { "FixedRule": "..." }
    ],
    "// relation": "组合条件类型: AND, OR, NOR",
    "relation": "AND"
  },
  "// QueryRule": "条件查询规则",
  "QueryRule": {
    "// field": "字段",
    "field": "field",
    "// value": "值",
    "value": "value",
    "// operation": "操作类型: EQ, NE, LT, LTE, GT, GTE...",
    "operation": "EQ"
  },
  "// FixedRule": "固定查询规则",
  "FixedRule": {
    "// wrapperRule": "对QueryRule的一次包装",
    "wrapperRule": { "QueryRule": "..." }
  }
}
```

##### 请求体json示例

```json
{
  "page": {
    "pageNumber": 1,
    "pageSize": 20
  },
  "sort": {
    "properties": ["folder", "lastModifiedDate"],
    "direction": "DESC"
  },
  "rule": {
    "rules": [{
      "field": "projectId",
      "value": "test-xiaoyushen",
      "operation": "EQ"
    }, {
      "field": "repoName",
      "value": "mock-public-global",
      "operation": "EQ"
    }, {
      "field": "path",
      "value": "/",
      "operation": "EQ"
    }],
    "relation": "AND"
  }
}
```

### 返回结果

| 字段      | 说明     |
|---------|--------|
| code    | 返回码    |
| message | 错误信息   |
| data    | 数据     |
| traceId | 链路追踪id |

#### 响应体示例

```json
{
  "code" : 0,
  "message" : null,
  "data" : {
    "pageNumber" : 1,
    "pageSize" : 20,
    "totalRecords" : 2,
    "totalPages" : 1,
    "records" : [ {
      "createdBy" : "xiaoyushen",
      "createdDate" : "2023-05-26T11:41:52.231",
      "lastModifiedBy" : "system",
      "lastModifiedDate" : "2023-06-28T16:19:50.954",
      "recentlyUseDate" : "2023-06-28T16:19:37.567",
      "lastAccessDate" : 1685072512231,
      "folder" : false,
      "path" : "/",
      "name" : "HelmForLocal2.jar",
      "fullPath" : "/HelmForLocal2.jar",
      "size" : 13256635,
      "sha256" : "7ed11ef0987f2be7e3d56af3133505d5297fdc1651d5ef509eeaf0684068ea3d",
      "md5" : "2da578b44d6eb865e57d7afefa8cb0f8",
      "metadata" : {
        "scanStatus" : "QUALITY_PASS",
        "qualityRedLine" : true
      },
      "projectId" : "test-xiaoyushen",
      "repoName" : "mock-public-global",
      "id" : "64702a804b598944f688dabe",
      "nodeMetadata" : [ {
        "key" : "scanStatus",
        "value" : "QUALITY_PASS",
        "system" : true,
        "description" : null
      }, {
        "key" : "qualityRedLine",
        "value" : true,
        "system" : true,
        "description" : null
      } ]
    }, {
      "createdBy" : "xiaoyushen",
      "createdDate" : "2023-06-20T15:34:08.001",
      "lastModifiedBy" : "xiaoyushen",
      "lastModifiedDate" : "2023-06-20T15:34:08.001",
      "lastAccessDate" : 1687246448001,
      "folder" : false,
      "path" : "/",
      "name" : "title-repo-2023-06-19-20-38-21.xlsx",
      "fullPath" : "/title-repo-2023-06-19-20-38-21.xlsx",
      "size" : 3952,
      "sha256" : "f0b728f0d39f5bc24b32879e8b729f5be9dcffb7634f9f015ea6f9fc9adf6144",
      "md5" : "9a2131c35251bca54607c9a4cc93e233",
      "metadata" : { },
      "projectId" : "test-xiaoyushen",
      "repoName" : "mock-public-global",
      "id" : "64915670ef9b8d0d9ee63f21",
      "nodeMetadata" : [ ]
    } ],
    "count" : 2,
    "page" : 1
  },
  "traceId" : ""
}
```

#### data 字段说明

分页信息

| 字段           | 说明                     |
|--------------|------------------------|
| pageNumber   | 页码(从1页开始)              |
| pageSize     | 每页多少条                  |
| totalRecords | 总记录条数                  |
| totalPages   | 总页数                    |
| records      | **数据列表**               |
| count        | 已废弃, 由`totalRecords`代替 |
| page         | 已废弃, 由`pageNumber`代替   |

##### records 字段说明

节点信息

| 字段                     | 说明           |
|------------------------|--------------|
| createdBy              | 创建者          |
| createdDate            | 创建时间         |
| lastModifiedBy         | 修改者          |
| lastModifiedDate       | 修改时间         |
| recentlyUseDate        | 最近使用时间时间     |
| lastAccessDate         | 访问时间         |
| folder                 | 是否为文件夹       |
| path                   | 路径           |
| name                   | 资源名称         |
| fullPath               | 完整路径         |
| size                   | 文件大小, 单位byte |
| expireDate             | 过期时间         |
| sha256                 | 文件sha256     |
| md5                    | 文件md5        |
| metadata               | 元数据          |
| projectId              | 所属项目id       |
| repoName               | 所属仓库名称       |
| id                     | 节点id         |
| copyFromCredentialsKey | 拷贝的源存储key    |
| copyIntoCredentialsKey | 拷贝的目标存储key   |
| deleted                | 删除时间(存在时才返回) |
| nodeMetadata           | 节点元数据(推荐使用)  |
